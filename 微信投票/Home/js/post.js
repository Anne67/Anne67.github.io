var _pic={_srcs:[],_getWidth:function(o){with(new Image()){src=o.src;return parseInt(width);}}};var _postPic={_resizeAll:function(){var _img=$(_richText._id).getElementsByTagName("img"),_parentWidth=$(_richText._id).offsetWidth- 8;for(var i=0,len=_img.length;i<len;i++){var _imgWidth=_pic._getWidth(_img[i]);if(_imgWidth>_parentWidth){_img[i].style.width=_parentWidth+"px";}else{_img[i].style.width=_imgWidth+"px";}}},_resize:function(o){var _parentWidth=$(_richText._id).offsetWidth- 8;var _imgWidth=_pic._getWidth(o);if(_imgWidth>_parentWidth){o.style.width=_parentWidth+"px";}else{o.style.width=_imgWidth+"px";}}};var _upload={_limit:function(path){return path.match(/\.(gif|jpg|jpeg|png)$/i)==null;},_ok:null};var _richText={_id:"",_init:function(id){_richText._id=id;_upload._ok=_richText._uploadOk;_postPic._resizeAll();_e._add(window,"resize",_postPic._resizeAll);},_setValue:function(value){$(_richText._id).innerHTML=value;},_getValue:function(){return $(_richText._id).innerHTML;},_isEmpty:function(){return $(_richText._id).innerHTML.replace(/(<br>)/ig,"").replace(/(&nbsp;)/ig,"").replace(/ /ig,"")=="";},_onFocus:function(){_richText._placeHolder(true);},_onBlur:function(){_richText._update();_richText._placeHolder();_system._set(_richText._id,$(_richText._id).innerHTML);},_onPaste:function(){_richText._update();_richText._placeHolder(true);_system._set(_richText._id,$(_richText._id).innerHTML);},_placeHolder:function(clear){$(_richText._id+"_placeholder").innerHTML=clear?"":(_richText._isEmpty()?$(_richText._id).getAttribute("placeholder"):"");},_update:function(){},_upload:function(){if(_upload._limit($(_richText._id+"_upload_file").value)){_system._toast("只能选择图片文件");return;}
_system._loading("上传中");$(_richText._id+"_upload").submit();},_uploadOk:function(state,error,saveUrl){_system._loading();$(_richText._id+"_upload").reset();if(state!="0"){_system._toast(error);return;}
_richText._insertPic(saveUrl);_richText._placeHolder();},_insertPic:function(url){var _html="<p><img src=\""+url+"\"></p><br>";$(_richText._id).focus();document.execCommand('InsertHtml',false,_html);},};